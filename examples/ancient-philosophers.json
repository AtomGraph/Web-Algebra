{
  "@op": "ForEach",
  "args": {
    "select": {
      "@op": "SELECT",
      "args": {
        "endpoint": {
          "@op": "Uri",
          "args": {
            "input": "https://query.wikidata.org/sparql"
          }
        },
        "query": {
          "@op": "Str",
          "args": {
            "input": "SELECT DISTINCT ?philosopher ?philosopherLabel ?birthPlace ?birthPlaceLabel ?school ?schoolLabel ?death WHERE { ?philosopher wdt:P106 wd:Q4964182 . ?philosopher wdt:P19 ?birthPlace . ?birthPlace wdt:P17 ?country . FILTER(?country IN (wd:Q41, wd:Q38, wd:Q142, wd:Q29, wd:Q183, wd:Q38)) OPTIONAL { ?philosopher wdt:P135 ?school } OPTIONAL { ?philosopher wdt:P570 ?death } FILTER(?death < \"500-01-01\"^^xsd:dateTime || !BOUND(?death)) SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". } } ORDER BY ?death LIMIT 12"
          }
        }
      }
    },
    "operation": [
      {
        "@op": "Variable",
        "args": {
          "name": "philosophicalWorks",
          "value": {
            "@op": "SELECT",
            "args": {
              "endpoint": {
                "@op": "Uri",
                "args": {
                  "input": "https://query.wikidata.org/sparql"
                }
              },
              "query": {
                "@op": "Substitute",
                "args": {
                  "query": {
                    "@op": "Str",
                    "args": {
                      "input": "SELECT ?work ?workLabel ?subject ?subjectLabel WHERE { ?work wdt:P50 ?philosopher . ?work wdt:P31/wdt:P279* wd:Q47461344 . OPTIONAL { ?work wdt:P921 ?subject } SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". } } LIMIT 8"
                    }
                  },
                  "var": "philosopher",
                  "binding": {
                    "value": {
                      "@op": "Str",
                      "args": {
                        "input": {
                          "@op": "Value",
                          "args": {
                            "name": "philosopher"
                          }
                        }
                      }
                    },
                    "type": "uri"
                  }
                }
              }
            }
          }
        }
      },
      {
        "@op": "PUT",
        "args": {
          "url": {
            "@op": "ResolveURI",
            "args": {
              "base": {
                "@op": "Uri",
                "args": {
                  "input": "https://localhost:4443/philosophy/thinkers/"
                }
              },
              "relative": {
                "@op": "Replace",
                "args": {
                  "input": {
                    "@op": "EncodeForURI",
                    "args": {
                      "input": {
                        "@op": "Str",
                        "args": {
                          "input": {
                            "@op": "Value",
                            "args": {
                              "name": "philosopherLabel"
                            }
                          }
                        }
                      }
                    }
                  },
                  "pattern": "%20",
                  "replacement": "-"
                }
              }
            }
          },
          "data": {
            "@context": {
              "foaf": "http://xmlns.com/foaf/0.1/",
              "dct": "http://purl.org/dc/terms/",
              "philosophy": "http://example.org/philosophy/",
              "schema": "https://schema.org/"
            },
            "@id": {
              "@op": "Str",
              "args": {
                "input": {
                  "@op": "Value",
                  "args": {
                    "name": "philosopher"
                  }
                }
              }
            },
            "@type": "schema:Person",
            "foaf:name": {
              "@op": "Str",
              "args": {
                "input": {
                  "@op": "Value",
                  "args": {
                    "name": "philosopherLabel"
                  }
                }
              }
            },
            "schema:birthPlace": {
              "@op": "Str",
              "args": {
                "input": {
                  "@op": "Value",
                  "args": {
                    "name": "birthPlaceLabel"
                  }
                }
              }
            },
            "philosophy:school": {
              "@op": "Str",
              "args": {
                "input": {
                  "@op": "Value",
                  "args": {
                    "name": "schoolLabel"
                  }
                }
              }
            },
            "philosophy:works": {
              "@op": "Bindings",
              "args": {
                "table": {
                  "@op": "Variable",
                  "args": {
                    "name": "$philosophicalWorks"
                  }
                }
              }
            },
            "schema:deathDate": {
              "@op": "Str",
              "args": {
                "input": {
                  "@op": "Value",
                  "args": {
                    "name": "death"
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}